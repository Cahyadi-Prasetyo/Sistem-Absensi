================================================================================
BRAINSTORMING: SISTEM ABSENSI REAL-TIME TERDISTRIBUSI
================================================================================
Tanggal: 10 November 2025
Update Terakhir: 14 November 2025

================================================================================
LATAR BELAKANG
================================================================================

Pada sistem absensi konvensional, data absensi biasanya hanya disimpan di satu 
server. Hal ini sering menimbulkan masalah, terutama jika ada beberapa cabang 
atau lokasi yang berbeda. Misalnya, ketika karyawan absen di kantor cabang A, 
data tersebut tidak langsung terlihat di kantor pusat atau cabang lain. 
Akibatnya, proses monitoring menjadi tidak efisien dan data bisa tidak sinkron.

================================================================================
TUJUAN PROYEK
================================================================================

Tujuan dari proyek ini adalah membuat website absensi yang dapat diakses dari 
beberapa node server dan setiap data absensi yang masuk akan otomatis muncul 
di semua server tanpa perlu refresh halaman.

Dengan cara ini, kami ingin menunjukkan bagaimana konsep sistem terdistribusi 
dan sinkronisasi data real-time dapat diterapkan dalam aplikasi web.

PRINSIP UTAMA:
1. Multi-node accessibility - Sistem dapat diakses dari beberapa server/node
2. Real-time synchronization - Data absensi muncul otomatis tanpa refresh
3. High availability - Jika satu server/container down, sistem tetap berjalan 
   menggunakan server/container lainnya
4. Clean architecture - Sistem berjalan sesuai dengan tujuan sebenarnya

================================================================================
KONSEP AWAL
================================================================================

Proyek: Sistem absensi real-time terdistribusi dengan fokus utama pada:
- Penerapan konsep sistem terdistribusi
- Sinkronisasi data antar node
- Komunikasi realtime antar pengguna dan server
- High availability dan fault tolerance

================================================================================
TECH STACK PILIHAN
================================================================================

Backend Framework: Laravel 12
- Dukungan kuat untuk event broadcasting
- Queue system yang robust
- Caching mechanism terintegrasi dengan Redis

Message Broker & Pub/Sub: Redis
- Message broker untuk komunikasi antar container
- Pub/Sub system untuk real-time data
- Simulasi sistem terdistribusi dalam Docker

Database: MySQL 8.0 (Production) / SQLite (Development)
- MySQL untuk Docker production: reliable, familiar, easy setup
- SQLite untuk local dev: zero configuration, fast iteration
- Migrations compatible dengan kedua database

Frontend: Blade + Alpine.js
Alasan pemilihan:
- Skala proyek kecil-menengah
- Fokus pada stabilitas komunikasi data, bukan kompleksitas UI
- Lebih ringan dan cepat dikembangkan
- Terintegrasi langsung dengan Laravel tanpa build kompleks
- Alpine.js tetap support elemen interaktif dan dinamis

WebSocket Server: Laravel Reverb
- Komunikasi real-time antar pengguna
- Update langsung di dashboard saat ada absensi baru

================================================================================
ARSITEKTUR SISTEM
================================================================================

Docker Container Setup:
- app-node-1 (Laravel)
- app-node-2 (Laravel) 
- app-node-3 (Laravel)
- reverb-server (WebSocket)
- redis (Pub/Sub + Cache)
- mysql (Database)
- nginx (Load Balancer)

Flow Data Real-time:
1. User absen di node-1 → simpan ke DB
2. Node-1 dispatch event ke Redis pub/sub
3. Semua node subscribe dan broadcast via Reverb
4. Frontend (Alpine.js) listen WebSocket dan update UI

================================================================================
KEPUTUSAN ARSITEKTUR
================================================================================

1. CONSISTENCY MODEL
   Pilihan: Eventual Consistency (max delay 1-2 detik)
   
   Alasan:
   - Lebih realistis untuk sistem real-world
   - Performance lebih baik
   - Cocok untuk use case absensi (tidak perlu strong consistency seperti banking)

2. CONFLICT RESOLUTION STRATEGY
   Pilihan: First-Write-Wins + Timestamp Validation
   
   Implementasi:
   - Absensi pertama yang diterima sistem (berdasarkan timestamp) yang valid
   - Duplikasi dalam 5 menit akan di-reject otomatis
   - Log semua attempt untuk audit trail
   - Simple tapi efektif untuk prevent abuse

3. PARTITIONING STRATEGY
   Pilihan: Random/Round-robin (Stateless)
   
   Karakteristik:
   - Semua node equal, tidak ada special assignment
   - Load balancer (Nginx) yang distribute traffic
   - Paling mudah untuk scale dan maintenance
   - Kalau satu node down, traffic otomatis ke node lain

4. FAILURE HANDLING
   Pilihan: High Availability dengan Graceful Degradation
   
   Mekanisme:
   - Absensi tetap jalan selama minimal 1 node hidup
   - Queue di-persist ke Redis (survive restart)
   - WebSocket auto-reconnect dengan exponential backoff
   - Health check setiap 10 detik
   - Nginx load balancer otomatis route ke node yang sehat
   - Shared database (MySQL) memastikan data consistency
   
   Skenario Failure:
   - 1 node down → Traffic dialihkan ke 2 node lainnya (sistem tetap 100% operasional)
   - 2 node down → Traffic ke 1 node tersisa (sistem tetap operasional, performa menurun)
   - Redis down → Queue dan cache hilang, tapi absensi tetap bisa (degraded mode)
   - MySQL down → Sistem tidak bisa terima absensi baru (critical failure)
   - Reverb down → Real-time update hilang, tapi absensi tetap bisa (perlu manual refresh)

5. MVP FEATURE SET
   
   Core Features:
   ✅ Absen masuk/keluar dengan geolocation & timestamp
   ✅ Real-time dashboard (list absensi hari ini)
   ✅ 3 Docker nodes + load balancer
   ✅ Sync indicator (show node mana yang handle + latency)
   ✅ Basic conflict detection & prevention
   ✅ Simple admin panel (lihat semua absensi)

================================================================================
TECH STACK FINAL
================================================================================

- Laravel 12 (Backend API + Blade views)
- Alpine.js (Frontend interactivity)
- Laravel Reverb (WebSocket server)
- Redis (Cache + Pub/Sub + Queue)
- MySQL 8.0 (Database - Docker production)
- SQLite (Database - Local development)
- Docker Compose (Orchestration)
- Nginx (Load Balancer)

================================================================================
DATABASE SCHEMA
================================================================================

Table: attendances
- id
- user_id
- type (in/out)
- timestamp
- latitude
- longitude
- node_id
- created_at
- updated_at

Table: attendance_logs (event sourcing)
- id
- attendance_id
- event_type
- node_id
- payload (JSON)
- created_at

Table: users
- id
- name
- email
- role (student/teacher/admin)

================================================================================
KONSEP DISTRIBUTED SYSTEMS YANG DIIMPLEMENTASIKAN
================================================================================

1. Load Balancing & High Availability
   - Nginx round-robin ke multiple Laravel nodes
   - Health check untuk auto-failover

2. Data Consistency
   - Optimistic locking untuk prevent double absensi
   - Event sourcing untuk audit trail lengkap
   - Redis distributed lock untuk critical sections

3. Real-time Synchronization
   - Laravel Broadcasting dengan Redis driver
   - Reverb untuk WebSocket connections
   - Presence channels untuk track "who's online"

4. Queue & Async Processing
   - Redis queue untuk background jobs
   - Horizon untuk monitoring
   - Failed job handling dan retry mechanism

================================================================================
DEMONSTRASI KEMAMPUAN SISTEM
================================================================================

Dengan setup ini, sistem dapat mendemonstrasikan:
- Load balancing & distribution
- Real-time communication
- Data synchronization
- Conflict handling
- System resilience
- High availability (sistem tetap jalan meski ada node yang down)
- Fault tolerance (graceful degradation)

================================================================================
CATATAN PENTING
================================================================================

STRUKTUR FILE:
- Semua dokumentasi brainstorming disimpan di folder /docs
- Jangan biarkan root project dipenuhi file yang tidak penting
- Setiap perubahan rencana harus diupdate di file brainstorming ini terlebih dahulu
- File ini menjadi single source of truth untuk keputusan arsitektur

PRINSIP DEVELOPMENT:
- Clean architecture - setiap komponen punya tanggung jawab yang jelas
- Sistem harus berjalan sesuai tujuan sebenarnya (real distributed system)
- Prioritas: Functionality > Performance > Aesthetics
- Test failure scenarios untuk memastikan high availability bekerja

================================================================================
END OF DOCUMENT
================================================================================


================================================================================
UI/UX DESIGN
================================================================================

HALAMAN UTAMA:

1. DASHBOARD ADMIN
   Layout:
   - Sidebar kiri: Logo sistem, menu navigasi (Dashboard, Riwayat, Tentang Sistem)
   - Header: Judul halaman, tanggal, notifikasi, user profile (Admin/Administrator)
   - Content area: Cards dan informasi utama
   
   Komponen Dashboard:
   - 4 Metric Cards (warna berbeda):
     * Absensi Hari Ini (biru) - Jumlah karyawan yang sudah absen
     * Minggu Ini (hijau) - Total absensi minggu ini
     * Tingkat Kehadiran (ungu) - Persentase kehadiran
     * Server Online (orange) - Status server aktif (3/4)
   
   - Panel "Absensi Terbaru" (Real-time):
     * Indicator "Live" (hijau) untuk menunjukkan data real-time
     * List absensi terbaru dengan foto, nama, waktu, status (Masuk)
     * Auto-update tanpa refresh
   
   - Panel "Status Server":
     * List server dengan lokasi (Jakarta, Bandung, Surabaya, Bali)
     * Status Online/Offline dengan indicator warna (hijau/merah)
     * Info sinkronisasi terakhir (X detik/menit lalu)

2. RIWAYAT ABSENSI
   Layout:
   - Header: "Riwayat Absensi" dengan subtitle
   - Filter section:
     * Search box: "Cari berdasarkan nama..."
     * Date picker: "Filter Tanggal"
     * Button Export
   
   - Table dengan kolom:
     * Tanggal
     * Nama
     * Jam Masuk
     * Jam Pulang
     * Durasi (8j 55m)
     * Status (Hadir/Terlambat/Alpha) dengan badge berwarna

3. TENTANG SISTEM
   Layout:
   - Hero section dengan icon sistem
   - Judul: "Sistem Absensi Real-Time Terdistribusi"
   - Deskripsi: Platform absensi modern dengan arsitektur terdistribusi
   
   - Card "Tujuan Proyek" (biru):
     * Penjelasan lengkap tujuan implementasi
     * Highlight: ketersediaan data, high availability, konsistensi data
   
   - Section "Teknologi yang Digunakan":
     * Cards dengan icon untuk setiap teknologi
     * Laravel (merah), Redis (merah), MySQL/SQLite (kuning), dll.

DESIGN SYSTEM:

Color Palette:
- Primary: Blue (#3B82F6)
- Success: Green (#10B981)
- Warning: Yellow/Orange (#F59E0B)
- Danger: Red (#EF4444)
- Purple: (#A855F7)
- Dark Background: (#1E293B, #0F172A)
- Text: White/Light gray

Typography:
- Clean, modern sans-serif
- Hierarchy jelas (heading, body, caption)

Components:
- Rounded corners untuk cards dan buttons
- Shadow untuk depth
- Badge dengan warna sesuai status
- Icons dari library modern (Lucide/Heroicons)

Interactivity:
- Hover effects pada buttons dan cards
- Smooth transitions
- Real-time indicators (dot hijau "Live")
- Loading states untuk async operations

RESPONSIVE DESIGN:
- Mobile-first approach
- Sidebar collapse pada mobile
- Table menjadi cards pada mobile
- Touch-friendly button sizes


================================================================================
ROLE & PERMISSION SYSTEM
================================================================================

ROLE TYPES:

1. ADMIN/ADMINISTRATOR
   Akses:
   - Dashboard Admin (lihat semua data)
   - Riwayat Absensi (semua karyawan)
   - Tentang Sistem
   - Monitoring status server
   - Export data
   
   Fitur Khusus:
   - Lihat real-time absensi semua karyawan
   - Monitoring server status
   - Akses ke semua data historis
   - Analytics dan reporting

2. KARYAWAN/USER
   Akses:
   - Portal Karyawan (dashboard personal)
   - Absensi (masuk/pulang)
   - Riwayat Absensi (hanya data pribadi)
   - Tentang Sistem
   
   Fitur Khusus:
   - Hanya bisa lihat data absensi sendiri
   - Tidak bisa lihat data karyawan lain
   - Tidak bisa akses monitoring server
   - Absen masuk/pulang dengan geolocation

AUTHENTICATION & AUTHORIZATION:
- Login dengan email & password
- Session-based authentication
- Middleware untuk role checking
- Route protection berdasarkan role

================================================================================
UI/UX DESIGN - PORTAL KARYAWAN
================================================================================

4. DASHBOARD KARYAWAN (Portal Karyawan)
   Layout:
   - Sidebar kiri: Logo sistem, menu navigasi (Absensi, Riwayat, Tentang Sistem)
   - Header: "Portal Karyawan", tanggal, notifikasi, user profile (nama + role)
   - Content area: Personal dashboard
   
   Hero Section (Card biru):
   - Greeting: "Halo, [nama_karyawan]!"
   - Tanggal hari ini
   - Lokasi: "Jakarta Pusat" (dari geolocation)
   - Button: "Belum Absen" (call-to-action)
   
   Absensi Actions (2 Cards):
   
   a) Card "Absen Masuk" (biru):
      - Icon: Arrow masuk
      - Judul: "Absen Masuk"
      - Deskripsi: "Klik tombol di bawah untuk mencatat waktu kedatangan Anda"
      - Button: "Absen Masuk" (primary blue)
      - State: Aktif sebelum absen masuk
   
   b) Card "Absen Pulang" (orange/disabled):
      - Icon: Arrow keluar (gray)
      - Judul: "Absen Pulang"
      - Deskripsi: "Klik tombol di bawah untuk mencatat waktu kepulangan Anda"
      - Button: "Absen Pulang" (disabled/orange)
      - Note: "Absen masuk terlebih dahulu"
      - State: Disabled sampai user sudah absen masuk
   
   Info Section:
   - Card "Sistem Sinkronisasi Real-Time"
   - Penjelasan tentang sistem terdistribusi
   - Informasi bahwa data akan tersinkronisasi otomatis

5. RIWAYAT ABSENSI KARYAWAN
   Layout:
   - Header: "Riwayat Absensi" dengan subtitle "Lihat riwayat absensi Anda"
   - Filter section:
     * Date picker: "Filter Tanggal"
     * Button Export (untuk data pribadi)
   
   - Table dengan kolom:
     * Tanggal
     * Nama (hanya nama user yang login)
     * Jam Masuk
     * Jam Pulang
     * Durasi
     * Status (Hadir/Terlambat/Alpha)
   
   - Empty state: "Tidak ada data riwayat ditemukan"
   - Pagination: "Menampilkan 0 dari 0 data"

BUSINESS LOGIC - ABSENSI FLOW:

1. Absen Masuk:
   - User klik "Absen Masuk"
   - Sistem request geolocation permission
   - Capture: timestamp, latitude, longitude, node_id
   - Simpan ke database
   - Broadcast event ke semua node (real-time)
   - Button "Absen Masuk" disabled
   - Button "Absen Pulang" enabled
   - Show success notification

2. Absen Pulang:
   - Button hanya aktif setelah absen masuk
   - User klik "Absen Pulang"
   - Capture: timestamp, latitude, longitude
   - Update record absensi hari ini
   - Calculate durasi kerja
   - Broadcast event ke semua node
   - Show success notification

3. Validasi:
   - Cek apakah sudah absen hari ini (prevent duplicate)
   - Validasi geolocation (optional: radius check)
   - Validasi waktu (tidak bisa absen pulang sebelum masuk)
   - Conflict resolution: First-Write-Wins

DATA ISOLATION:
- Setiap user hanya bisa query data dengan WHERE user_id = auth()->id()
- Policy/Gate untuk enforce authorization
- API endpoint terpisah untuk admin vs user
- Middleware untuk validasi akses data

